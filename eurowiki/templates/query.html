{% extends "eurowiki_base.html" %}
{% load static i18n %}

{% block body %}

{% if query and query_result %}
	<h5 class="text-center">{% trans "running query"|capfirst %} <i>{{ query.title|capfirst }}</i></h5>
	<div class="text-center"><i>{{ query.description|capfirst }}</i></div>
	<div style="margin-top: 1em; margin-bottom: 1em;">
	{{ query_result|safe}}
	</div>
	<div style="text-align: center; margin-top: 1em; margin-bottom: 1em;">
		<a class="btn btn-light" href="/query/{{ query.id }}/export/" title="{% trans "execute query and export result" %}">{% trans "export result"|capfirst %}</a>
	</div>

{% elif form %}
	{% if query %}
	<h5 class="text-center">{% trans "edit query"|capfirst %} <i>{{ query.title|capfirst }}</i></h5>
	<form action="/query/" method="post" class="form-horizontal">{% csrf_token %}
		{{ form.as_table}}
		<div style="text-align: center; margin-top: 1em; margin-bottom: 1em;">
			<input type="submit" class="btn btn-light" name="save" value="{% trans "save"|capfirst %}"/>
		&nbsp; <input type="submit" class="btn btn-light" name="save_continue" value="{% trans "save & continue"|capfirst %}"/>
		&nbsp; <a class="btn btn-light" href="/query/{{ query.id }}/">{% trans "cancel"|capfirst %}</a>
		</div>
	</form>

	{% else %}
	<h5 class="text-center">{% trans "define new query"|capfirst %}</h5>
	<form action="/query/" method="post" class="form-horizontal">{% csrf_token %}
		{{ form.as_table}}
		<div style="text-align: center; margin-top: 1em; margin-bottom: 1em;">
			<input type="submit" class="btn btn-light" name="save" value="{% trans "save"|capfirst %}"/>
		&nbsp; <input type="submit" class="btn btn-light" name="save_continue" value="{% trans "save & continue"|capfirst %}"/>
		&nbsp; <a class="btn btn-light" href="/query/">{% trans "cancel"|capfirst %}</a>
		</div>

		</div>
	{% endif %}

{% elif query %}
	<h5 class="text-center">{% trans "definition of query"|capfirst %} <i>{{ query.title|capfirst}}</i></h5>
	<dl>
	<dt>{% trans "description"|capfirst %}</dt> <dd>{{ query.description }}</dd>
	<dt>{% trans "SPARQL text"|capfirst %}</dt> <dd><pre>{{ query.text }}</pre></dd>
	</dl>

{% else %}
	<h5 class="text-center">{% trans "saved query definitions"|capfirst %}</h5>

	{% if queries.count %}
		<ul>
		{% for query in queries %}
			<li><strong>{{ query.title }}</strong>
		         &nbsp; <a class="btn btn-light" href="/query/{{ query.id }}/run/" title="{% trans "execute query" %}"><i class="fa fa-play font07em c-white"></i></a>
		         &nbsp; <a class="btn btn-light" href="/query/{{ query.id }}/export/" title="{% trans "execute query and export result" %}"><i class="fa fa-download font07em c-white"></i></a>
		         &nbsp; <a class="btn btn-light" href="/query/{{ query.id }}/" title="{% trans "view definition" %}"><i class="fa fa-eye font07em c-white"></i></a>
		        {% if can_edit %} &nbsp; <a class="btn btn-light" href="/query/{{ query.id }}/edit/" title="{% trans "show edit view" %}"><i class="fa fa-edit font07em c-white"></i></a>{% endif %}
		        {% if can_delete %} &nbsp; <a class="btn btn-light" href="/query/{{ query.id }}/delete/" title="{% trans "delete query definition" %}"><i class="fa fa-times-circle font07em" aria-hidden="true" style="color: red;"></i></a>{% endif %}
				<br>{{ query.description }}</li>
		{% endfor %}
		</ul>

	{% else %}
		<div>{% trans "No query defined yet" %}</div>
	{% endif %}

	<form action="" method="post" class="form-horizontal">{% csrf_token %}
		<div style="text-align: center; margin-top: 1em; margin-bottom: 1em;">
			<input type="submit" class="btn btn-light" name="new_query" value="{% trans "add query"|capfirst %}"/>
		</div>
	</form>

{% endif %}
{% if not queries.count %}
	<div><a href="/query/">{% trans "list all saved queries"|capfirst %}</a></div>
{% endif %}

{% endblock body %}
